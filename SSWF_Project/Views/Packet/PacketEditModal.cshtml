@model Packet
@{
    int ProductCount = Model.Products.Count();
}

<div class="modal fade" id="@Model.Name.Replace(" ", "")" tabindex="-1" aria-labelledby="@Model.Name.Replace(" ", "")" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">
                    @Model.Name (@Model.FormatDateTime((DateTime) Model.PickUpTime))
                    <img class="info-icon" src="@Url.Content("~/images/info.png")" />
                    <span class="tooltiptext">Als een student dit pakket gereserveerd heeft kan deze niet aangepast worden.</span>
                </h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form asp-action="UpdatePacket" asp-controller="Packet" method="post">
                <div class="modal-body">
                    <div class="row">
                        <input asp-for="Id" value="@Model.Id" type="hidden"/>
                        @for (int i = 0; i < ProductCount; i++)
                        {
                            Model.Products.Add(Model.Products.ElementAtOrDefault(i));

                            <input asp-for="Products[i].Id" type="hidden">
                            <input asp-for="Products[i].Name" type="hidden">
                            <input asp-for="Products[i].Image" type="hidden">
                            <input asp-for="Products[i].HasAlcohol" type="hidden">
                        }
                        <div class="col-6 input-wrap">
                            <label asp-for="Name">Naam</label><br />
                            <input asp-for="Name" type="text" class="form-input" value="@Model.Name" />
                        </div>
                        <div class="col-6 input-wrap">
                            <label asp-for="Price">Prijs</label><br />
                            <input asp-for="Price" type="text" class="form-input" value="@Model.Price" />
                        </div>
                    </div>

                    <div class="row mt-3">
                        <div class="col-6">
                            <div class="select-wrap">
                                <label asp-for="MealType" for="mealtype">Type Maaltijd</label>
                                <select asp-for="MealType" asp-items="@ViewBag.MealTypeChoices" style="width: 100%;"></select>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="select-wrap">
                                <label asp-for="City" for="city">Stad</label>
                                <select asp-for="City" asp-items="@ViewBag.CityChoices" style="width: 100%;"></select>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-6">
                            <div class="select-wrap">
                                <label asp-for="CanteenId" for="canteen">Kantine</label>
                                <select asp-for="CanteenId" asp-items="@ViewBag.LocationChoices" style="width: 100%;"></select>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-6 input-wrap">
                            <label asp-for="PickUpTime">Ophaal datum</label><br />
                            <input asp-for="PickUpTime" type="date" class="datepicker" value="@Model.PickUpTime.Value.ToString("yyyy-MM-dd")" />
                        </div>
                        <div class="col-6 input-wrap">
                            <label asp-for="LastestPickUpTime">Ophalen tot</label><br />
                            <input asp-for="LastestPickUpTime" type="date" class="datepicker" value="@Model.LastestPickUpTime.Value.ToString("yyyy-MM-dd")" />
                        </div>
                    </div>

                    <div class="row mt-3">
                        <div class="col-12">
                            <div class="col-lg-12">
                                <input asp-for="ContainsAlcohol" type="checkbox" class="contains-alcohol" checked="@Model.DoesPacketContainAlcohol()" />
                                <label asp-for="ContainsAlcohol" for="checkbox">Bevat alcohol</label>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-3">
                        <div class="col-10">
                            <input class="form-input" type="text" placeholder="Zoek hier naar producten" style="width: 99%;" />
                        </div>
                        <div class="col-1 mt-2">
                            <button type="submit" class="modal-button">
                                <img class="admin-icon-smaller" src="@Url.Content("~/images/search.png")" />
                            </button>
                        </div>
                        <div class="col-12" style="overflow-y: scroll; height:285px;">
                            @foreach (var product in Model?.Products ?? Enumerable.Empty<Product>())
                            {
                                <div class="col-12 product-admin p-0">
                                    <img class="box-icon shadow" src="@product.Image" style="max-height:75px;" />
                                    <div class="packet-text ps-3 pe-2">
                                        <h5>@product.Name</h5>
                                    </div>

                                    <div class="packet-right">
                                        @if (Model.Products.Contains(product))
                                        {
                                            <img class="admin-icon" src="@Url.Content("~/images/delete.png")" />
                                        }
                                        else
                                        {
                                            <img class="admin-icon" src="@Url.Content("~/images/plus.png")" />
                                            @if (product != null) {
                                                Model.Products.Add(product);
                                            }
                                            
                                        }
                                    </div>

                                </div>
                                <hr />
                            }
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="button-darkgreen"><span>Opslaan</span></button>
                </div>
            </form>
        </div>
    </div>
</div>
